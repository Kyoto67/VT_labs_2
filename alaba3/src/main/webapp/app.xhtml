<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<f:view>
    <h:head>
        <title>Main page</title>
        <link rel="stylesheet" href="style.css"/>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    </h:head>
    <h:body>

        <h:outputScript library="js" name="interactive_area.js"/>

        <div class="hat">
            <h:outputLabel>Лабораторная работа</h:outputLabel>
            <br/>
            <h:outputLabel>по Веб-Программированию №1</h:outputLabel>
            <br/>
            <h:outputLabel>вариант: 3974</h:outputLabel>
            <br/>
            <h:outputLabel>выполнил: Птицын Максим Евгеньевич</h:outputLabel>
            <br/>
            <h:outputFormat>группа: P32311</h:outputFormat>

        </div>

        <h:form>
            <div id="toStartButton">            <h:commandButton value="To start page" action="toStart"/>
            </div>
        </h:form>

        <div class="Input_Block">

            <div class="area">
                <div class="label"><h:outputLabel>График:</h:outputLabel></div>
                <br/>
                <div id="plot">
                    <ui:repeat id="adsfg" var="obj" value="#{appbean.results}">
                        <span class="point" id="#{obj.match.toString()}" style="left: #{(94.5+obj.x/obj.r*80)}px; top: #{(135+obj.y/obj.r*-80)}px"></span>
                    </ui:repeat>
                </div>
                <h:graphicImage id="area" value="img/areas.png"/>
            </div>

            <h:form id="form">

                <h:inputHidden id="timeOffset" value="#{appbean.timeOffset}"/>


                <div class="data">
                    <div class="label"><h:outputLabel>Введите данные:</h:outputLabel></div>
                    <!-- X block -->
                    <p><h:outputLabel for="x">x:</h:outputLabel>
                        <h:inputHidden id="x" value="#{appbean.x}"/>
                        <p:spinner for="x" min="-5" max="5" stepFactor="1" rotate="true" round="true"
                                   buttons="horizontal"/>
                    </p>

                    <!-- Y block -->
                    <p><h:outputLabel for="y">y:</h:outputLabel>
                        <h:inputText size="4" maxlength="5" id="y" value="#{appbean.y}" validatorMessage="Y should be a float from -5 to 5">
                            <f:validateDoubleRange minimum="-5" maximum="5"/>
                            <f:validateRequired/>
                            <f:ajax event="keyup" render="y-warning" execute="y"/>
                        </h:inputText>
                        <p><h:message id="y-warning" styleClass="warning" for="y"/></p>
                    </p>

                    <!-- R block -->
                    <h:inputHidden id="r-value_fixator" value="#{appbean.oldR}"/>
                    <p><h:outputLabel for="r">r:</h:outputLabel>
                        <h:inputHidden id="r" value="#{appbean.r}"/>
                        <h:outputText id="r-display" value="#{appbean.r}"/>
                        <p:slider for="r" display="r-display" minValue="2" maxValue="5" step="0.1" >
                            <f:ajax event="slideEnd" onevent="redrawPoints"/>
                        </p:slider>
                    </p>
                    <h:commandButton id="submitButton" action="#{appbean.submit()}" value="Send"/>
                </div>
            </h:form>
        </div>

        <h:outputScript library="js" name="area_changer.js"/>

        <div class="resultbody" id="outputContainer">
                <h:dataTable id="maintable" border="1" value="#{appbean.getResults()}" var="row">
                    <h:column>
                        <f:facet name="header">
                            <h:outputText value="№"/>
                        </f:facet>
                        <h:outputText class="cellNum" value="#{row.sequenceNumber}"/>
                    </h:column>
                    <h:column >
                        <f:facet name="header">
                            <h:outputText class="cellNum" value="X"/>
                        </f:facet>
                        <h:outputText value="#{row.x}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText class="cellNum" value="Y"/>
                        </f:facet>
                        <h:outputText value="#{row.y}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText class="cellNum" value="R"/>
                        </f:facet>
                        <h:outputText value="#{row.r}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText class="cellRes" value="Result"/>
                        </f:facet>
                        <h:outputText value="#{(row.match ? 'Hit' : 'Miss')}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText class="cellTime" value="Working time"/>
                        </f:facet>
                        <h:outputText value="#{row.workingTime}"/>
                    </h:column>
                    <h:column>
                        <f:facet name="header">
                            <h:outputText class="cellCurTime" value="Current time"/>
                        </f:facet>
                        <h:outputText value="#{row.currentDateandTime.getHours()}:#{row.currentDateandTime.getMinutes()}:#{row.currentDateandTime.getSeconds()}"/>
                    </h:column>
                </h:dataTable>
        </div>

        <script>
            window.onload = () => {
                document.getElementById("form:timeOffset").value = (new Date()).getTimezoneOffset();
            }
        </script>
    </h:body>
</f:view>
</html>